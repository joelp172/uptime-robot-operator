---
description: Testing standards and commands for uptime-robot-operator
alwaysApply: true
---

# Testing Guide

## Test Commands

| Command | Description |
|---------|-------------|
| `make test` | Run unit tests with envtest |
| `make lint` | Run golangci-lint |
| `make test-e2e` | Run basic e2e tests (no API key required) |
| `make test-e2e-real` | Run full e2e tests (requires `UPTIME_ROBOT_API_KEY`) |

## Running Tests Locally

### Unit Tests

```bash
make test
```

### E2E Tests (Basic)

Requires a Kind cluster named `kind`. Use `make dev-cluster` to create and set up the cluster:

```bash
# Create cluster and deploy operator
make dev-cluster

# Run basic tests (suite builds/loads image automatically)
make test-e2e
```

### E2E Tests (Full with Real API)

**Note**: Tests default to `https://api.uptimerobot.com/v3`. To use a different API endpoint (e.g., mock server), export `UPTIME_ROBOT_API` before running.

```bash
# Run full e2e tests with real API
export UPTIME_ROBOT_API_KEY='your-api-key'
make test-e2e-real

# With debug logging enabled
E2E_DEBUG=1 make test-e2e-real
```

### Debug Logging

Set `E2E_DEBUG=1` (or `true`/`yes`) to enable detailed debug output for API calls and validations:

```bash
# Enable debug logging
E2E_DEBUG=1 make test-e2e-real

# Disable debug logging (default)
make test-e2e-real
```

Debug logging shows:
- API endpoint being used
- Monitor ID being queried
- Full monitor response details
- Field validation comparisons
- Success/failure of each validation step

## Before Committing

Always run:

```bash
make manifests generate fmt vet lint test
```

## Quick Validation Script

```bash
make manifests generate fmt vet && make lint && make test
```

## Notes

- Unit tests use envtest (mock Kubernetes API)
- E2E tests require Kind cluster named `kind`
- Use `make dev-cluster` to create the cluster and deploy the operator
- Kind automatically sets kubectl context to `kind-kind` when creating the cluster
- Full e2e tests create real monitors in UptimeRobot (use dev account)
- Clean up with: `make dev-cluster-delete`
